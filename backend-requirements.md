# Требования к Backend для стриминговой платформы SF

## Общее описание
Backend должен обеспечивать функционирование стриминговой платформы, позволяющей пользователям создавать прямые трансляции, просматривать их и управлять своим профилем.

## Технические требования
1. **Архитектура:** 
   - RESTful API для основных операций
   - WebSocket для обновления счетчиков зрителей
   - Медиа-сервер для обработки потоков (RTMP, HLS)

2. **Технологии:**
   - Node.js/Express или SpringBoot (Java) или Django (Python)
   - База данных: PostgreSQL/MySQL
   - Redis для кэширования и управления сессиями
   - WebSocket сервер (Socket.io, если Node.js)
   - Медиа-сервер (NGINX-RTMP или аналог)

3. **Безопасность:**
   - JWT аутентификация
   - HTTPS
   - Защита от CSRF/XSS
   - Валидация входных данных
   - Ограничение запросов (Rate limiting)

## API Endpoints

### Аутентификация и пользователи
- `POST /api/auth/register` - регистрация нового пользователя
- `POST /api/auth/login` - авторизация пользователя
- `POST /api/auth/logout` - выход из системы
- `GET /api/auth/refresh-token` - обновление токена

### Профиль пользователя
- `GET /api/users/profile` - получение данных профиля текущего пользователя
- `PUT /api/users/profile` - обновление профиля пользователя
- `POST /api/users/change-password` - изменение пароля
- `GET /api/users/{username}` - получение публичной информации о пользователе

### Управление ключами стрима
- `GET /api/stream/key` - получение ключа стрима пользователя
- `POST /api/stream/key/reset` - сброс ключа стрима
- `PUT /api/stream/settings` - обновление настроек стрима по умолчанию

### Управление стримами
- `POST /api/streams` - создание нового стрима
- `GET /api/streams` - получение списка активных стримов (с фильтрацией)
- `GET /api/streams/{id}` - получение информации о конкретном стриме
- `PUT /api/streams/{id}` - обновление информации о стриме (название, категория и т.д.)
- `DELETE /api/streams/{id}` - завершение стрима
- `GET /api/users/{username}/streams` - получение стримов пользователя

### Управление категориями
- `GET /api/categories` - получение списка категорий
- `GET /api/categories/{id}` - получение конкретной категории
- `GET /api/categories/{id}/streams` - получение стримов в категории

### Просмотры и статистика
- WebSocket эндпоинт `/ws/streams/{streamId}/viewers` для обновления информации о зрителях
- `GET /api/streams/{id}/statistics` - получение статистики просмотров
- `GET /api/users/{username}/statistics` - получение статистики стримера

## Модели данных

### Пользователь (User)
- id
- username
- email
- password (хешированный)
- avatar
- bio
- followers_count
- created_at
- updated_at

### Стрим (Stream)
- id
- user_id (связь с пользователем)
- title
- description
- thumbnail
- stream_key (закодирован/зашифрован)
- category_id (связь с категорией)
- is_live (статус)
- viewers_count
- is_private
- started_at
- ended_at
- created_at
- updated_at

### Категория (Category)
- id
- name
- description
- thumbnail
- viewers_count
- created_at
- updated_at

### Подписка (Follow)
- id
- follower_id (кто подписался)
- following_id (на кого подписался)
- created_at

## Функциональные требования

### Стриминг
1. Поддержка приема RTMP потока от стримера
2. Транскодирование входящего потока в различные качества (1080p, 720p, 480p)
3. Генерация HLS плейлистов для адаптивного стриминга
4. Поддержка низкой задержки (low latency) для стримов
5. Автоматическое создание превью (thumbnails)

### Профиль пользователя
1. Управление личной информацией
2. Изменение аватара
3. Управление ключом стрима
4. Настройки стрима по умолчанию

## Нефункциональные требования

### Производительность
1. API запросы должны обрабатываться в течение 200мс (p95)
2. Система должна поддерживать не менее 10000 одновременных зрителей для популярных стримов
3. Низкая задержка стриминга (<5 секунд)

### Масштабируемость
1. Горизонтальное масштабирование серверов API
2. Горизонтальное масштабирование медиа-серверов
3. Балансировка нагрузки

### Доступность
1. Доступность системы 99.9% (не более 43.8 минут простоя в месяц)
2. Автоматическое восстановление после сбоев

### Безопасность данных
1. Шифрование ключей стрима
2. Защита персональных данных в соответствии с законодательством
3. Регулярное резервное копирование данных

## Мониторинг и логирование
1. Мониторинг доступности API и медиа-серверов
2. Логирование всех API запросов
3. Алерты при возникновении ошибок
4. Мониторинг нагрузки на систему

## Масштабирование и развитие
1. Возможность добавления новых фич без остановки сервиса
2. Поддержка версионирования API
3. Документация API (Swagger/OpenAPI)
4. CI/CD для автоматического деплоя 